{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Shopping List Application Schema",
  "description": "MongoDB schema for a collaborative shopping list application",
  "version": "1.0.0",
  "definitions": {
    "ObjectId": {
      "type": "string",
      "pattern": "^[0-9a-fA-F]{24}$",
      "description": "MongoDB ObjectId as 24-character hex string"
    },
    "User": {
      "type": "object",
      "title": "User",
      "description": "Application user account",
      "required": ["name", "email", "is_active", "created_at", "updated_at"],
      "properties": {
        "id": {
          "$ref": "#/definitions/ObjectId",
          "description": "Unique user identifier"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 255,
          "description": "User's full name"
        },
        "email": {
          "type": "string",
          "format": "email",
          "maxLength": 255,
          "description": "Unique email address for authentication"
        },
        "password": {
          "type": "string",
          "minLength": 8,
          "maxLength": 255,
          "description": "Hashed password (store hash, not plaintext!)"
        },
        "is_active": {
          "type": "boolean",
          "description": "Whether the user account is active",
          "default": true
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Account creation timestamp"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Last account update timestamp"
        }
      },
      "additionalProperties": false
    },
    "ShoppingListItem": {
      "type": "object",
      "title": "Shopping List Item",
      "description": "Individual item in a shopping list",
      "required": ["_id", "name", "quantity", "created_by_user_id", "created_at", "updated_at"],
      "properties": {
        "_id": {
          "$ref": "#/definitions/ObjectId",
          "description": "Unique item identifier"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Item name or description"
        },
        "quantity": {
          "type": "number",
          "minimum": 0,
          "maximum": 9999,
          "description": "Quantity needed"
        },
        "purchased_at": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "When item was purchased (null if not purchased)"
        },
        "created_by_user_id": {
          "$ref": "#/definitions/ObjectId",
          "description": "Reference to user who added this item"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "When item was added to list"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "When item was last modified"
        }
      },
      "additionalProperties": false
    },
    "ShoppingList": {
      "type": "object",
      "title": "Shopping List",
      "description": "Collaborative shopping list",
      "required": ["title", "owner_id", "member_ids", "items", "created_at", "updated_at"],
      "properties": {
        "_id": {
          "$ref": "#/definitions/ObjectId",
          "description": "Unique list identifier"
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200,
          "description": "Shopping list title"
        },
        "owner_id": {
          "$ref": "#/definitions/ObjectId",
          "description": "Reference to user who owns this list"
        },
        "member_ids": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ObjectId"
          },
          "uniqueItems": true,
          "maxItems": 100,
          "description": "Array of user IDs who have access to this list"
        },
        "items": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ShoppingListItem"
          },
          "maxItems": 1000,
          "description": "Array of shopping list items",
          "default": []
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "List creation timestamp"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Last list modification timestamp"
        },
        "archived_at": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "When list was archived (null if active)"
        }
      },
      "additionalProperties": false
    }
  },
  "database": {
    "name": "myapp",
    "collections": {
      "users": {
        "description": "User accounts and authentication",
        "schema": {
          "$ref": "#/definitions/User"
        },
        "indexes": [
          {
            "name": "email_unique_idx",
            "fields": { "email": 1 },
            "options": { 
              "unique": true,
              "background": true
            },
            "description": "Unique constraint on email for authentication"
          },
          {
            "name": "active_users_idx",
            "fields": { "is_active": 1, "created_at": -1 },
            "options": { "background": true },
            "description": "Find active users, newest first"
          },
          {
            "name": "name_search_idx",
            "fields": { "name": 1 },
            "options": { "background": true },
            "description": "Search users by name"
          }
        ],
        "validationLevel": "strict",
        "validationAction": "error"
      },
      "shopping_lists": {
        "description": "Collaborative shopping lists with items",
        "schema": {
          "$ref": "#/definitions/ShoppingList"
        },
        "indexes": [
          {
            "name": "owner_lists_idx",
            "fields": { "owner_id": 1 },
            "options": { "background": true },
            "description": "Find lists owned by specific user"
          },
          {
            "name": "member_lists_idx", 
            "fields": { "member_ids": 1 },
            "options": { "background": true },
            "description": "Find lists where user is a member (multikey index)"
          },
          {
            "name": "created_date_idx",
            "fields": { "created_at": -1 },
            "options": { "background": true },
            "description": "Sort lists by creation date, newest first"
          },
          {
            "name": "updated_date_idx",
            "fields": { "updated_at": -1 },
            "options": { "background": true },
            "description": "Sort lists by last update, newest first"
          },
          {
            "name": "archive_status_idx",
            "fields": { "archived_at": 1 },
            "options": { 
              "background": true,
              "sparse": true
            },
            "description": "Filter by archive status (sparse for null values)"
          },
          {
            "name": "owner_by_date_idx",
            "fields": { "owner_id": 1, "created_at": -1 },
            "options": { "background": true },
            "description": "User's lists sorted by creation date"
          },
          {
            "name": "member_active_lists_idx",
            "fields": { "member_ids": 1, "archived_at": 1 },
            "options": { "background": true },
            "description": "Active lists for a member"
          },
          {
            "name": "text_search_idx",
            "fields": { 
              "title": "text", 
              "items.name": "text" 
            },
            "options": { 
              "background": true,
              "name": "TextIndexOnTitleAndItems",
              "weights": { 
                "title": 10, 
                "items.name": 1 
              }
            },
            "description": "Full-text search on list titles and item names"
          },
          {
            "name": "item_creator_idx",
            "fields": { "items.created_by_user_id": 1 },
            "options": { "background": true },
            "description": "Find lists with items created by specific user"
          }
        ],
        "validationLevel": "strict", 
        "validationAction": "error"
      }
    }
  },
  "relationships": {
    "users_to_lists": {
      "type": "one_to_many",
      "from": "users._id",
      "to": "shopping_lists.owner_id",
      "description": "A user can own multiple shopping lists"
    },
    "users_to_list_membership": {
      "type": "many_to_many", 
      "from": "users._id",
      "to": "shopping_lists.member_ids",
      "description": "Users can be members of multiple lists, lists can have multiple members"
    },
    "users_to_item_creation": {
      "type": "one_to_many",
      "from": "users._id", 
      "to": "shopping_lists.items.created_by_user_id",
      "description": "A user can create multiple items across different lists"
    }
  }
}